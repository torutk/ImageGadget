<?xml version="1.0" encoding="utf-8"?>

<?define ProductName = "Image Gadget" ?>
<?define Manufacturer = "High Bridge" ?>
<?define LauncherFileName = "imagegadget" ?>
<?define LicenseFileName = "License.rtf" ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Product Id="*" Name="$(var.ProductName)" 
           Language="1033" Version="0.2.0"
           Manufacturer="$(var.Manufacturer)" 
           UpgradeCode="7f321f89-8892-45e8-9cc6-09639d621fda">
    <Package Description="$(var.ProductName)"
             Comments="(c) 2019 $(var.Manufacturer)"
             InstallerVersion="200" Compressed="yes"
             InstallScope="perMachine" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed. Setup will now exit." />
    <MediaTemplate EmbedCab="yes" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
	<Directory Id="CompanyFolder" Name="$(var.Manufacturer)">
	  <Directory Id="APPLICATIONFOLDER" Name="$(var.ProductName)" />
	</Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
          <Directory Id="ApplicationProgramsFolder" Name="$(var.Manufacturer)" />
      </Directory>
    </Directory>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="*">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Icon="java.exe"
                  Name="$(var.ProductName)"
                  Show="minimized"
                  Target="[APPLICATIONFOLDER]\bin\$(var.LauncherFileName).bat"
                  WorkingDirectory="APPLICATIONFOLDER"/>
        <RemoveFolder Id="CleanUpShortcut"
                      Directory="ApplicationProgramsFolder"
                      On="uninstall" />
        <RegistryValue Root="HKCU"
                       Key="Software\[Manufacturer]\[ProductName]"
                       Name="installed" Type="integer" Value="1"
                       KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <Icon Id="java.exe" SourceFile="runtime\bin\java.exe" />
    
    <Feature Id="Product" Title="$(var.ProductName)" Level="1">
      <ComponentGroupRef Id="RuntimeGroup" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>

    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="APPLICATIONFOLDER" />
    <WixVariable Id="WixUILicenseRtf" Value="$(var.LicenseFileName)" />

  </Product>
</Wix>
